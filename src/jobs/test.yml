description: >
  Tests the project code using the test script provided by package.json

executor: docker-node

parameters:
  init-submodules:
    type: boolean
    default: false
    description: Whether or not to initialize submodules included in this repository.
  app-dir:
    type: string
    default: "."
    description: Path to the directory containing your package.json file. Not needed if package.json lives in the root.

steps:
  - setup:
      init-submodules: <<parameters.init-submodules>>
      app-dir: <<parameters.app-dir>>
  - run:
      name: Run tests
      working_directory: <<parameters.app-dir>>
      command: yarn run test:ci
  - codecov/upload:
      file: <<parameters.app-dir>>/reports/coverage/clover.xml
  - store_test_results:
      path: <<parameters.app-dir>>/reports/
  - store_artifacts:
      path: <<parameters.app-dir>>/reports/
