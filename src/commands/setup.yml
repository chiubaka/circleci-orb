description: >
  This command sets up the CI environment for the repository

parameters:
  init-submodules:
    type: boolean
    default: false
    description: Whether or not to initialize submodules included in this repository.
  yarn-install-dir:
    type: string
    default: '.'
    description: Path to run install scripts on. Should contain a package.json file.

steps:
  - checkout
  - when:
      condition: << parameters.init-submodules >>
      steps:
        - run:
            name: Initialize submodules
            command: git submodule update --init --recursive
  - run:
      working_directory: <<parameters.yarn-install-dir>>
      name: Use Yarn Berry
      command: yarn set version berry
  - node/install-packages:
      check-cache: always
      pkg-manager: yarn-berry
      with-cache: false
      app-dir: <<parameters.yarn-install-dir>>
